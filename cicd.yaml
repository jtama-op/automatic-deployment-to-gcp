imports:
  - path: cicd.py
  # The function code will be defined for the files in function/
  - path: function/index.js
  - path: function/package.json

resources:
  - name: function
    type: cicd.py
    properties:
      gitCredentialBucket: git-credential-bucket
      deployKey: deploy-key
      keyRing: gitlab-deploy-key
      functionName: push-event-endpoint
      # All the files that start with this prefix will be packed in the Cloud Function
      codeLocation: function/
      codeBucket: staging-bucket
      codeBucketObject: function.zip
      location: europe-west1
      timeout: 60s
      runtime: nodejs8
      availableMemoryMb: 256
      entryPoint: triggerCloudBuild
outputs:
  - name: function-code
    value: $(ref.function.sourceArchiveUrl)
  - name: function-name
    value: $(ref.function.name)